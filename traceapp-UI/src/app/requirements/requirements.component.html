<form style="margin-top: 30px; padding-right: 3%; padding-left: 4%; margin-bottom: 20px; text-align: center"
      (input)="searchChange()">
  <mat-form-field style="width: 96%;; vertical-align: middle" appearance="outline">
    <input style="padding-left: 5px; padding-bottom: 5px; font-size: 16px" type="text"
           placeholder="SEARCH FOR REQUIREMENTS BY KEY OR TITLE" [formControl]="searchControl" matInput
           (change)="searchChange()">
  </mat-form-field>
</form>

<div style="display: flex; flex-direction: row; height: 80%; width: 100%; justify-content: center">
  <mat-selection-list style="overflow:scroll; overflow-x: hidden; width:25%;" class="issues"
                      [multiple]="false">
    <div mat-subheader style="color: #000000; font-size: 16px;">Requirements</div>

    <mat-list-option *ngFor="let issue of issues" style="margin: 1px;"
                     (click)="getReq(issue.key); getClassesForReq(issue.key); edit = false; add = false;">
      <mat-card>
        <a style="font-weight: bold; margin: 1px;"
           href="https://hbrs.atlassian.net/browse/{{issue.key}}">{{issue.key}}</a>
        <p class="text">{{issue.fields.summary}}</p>
      </mat-card>
    </mat-list-option>

  </mat-selection-list>
  <div style="border-color: red; width: 65%; padding-left: 20px; padding-right: 20px; overflow-x:hidden"
       *ngIf="selectedIssue" class="issues">

    <p>{{selectedIssue.fields.project.name}} / {{selectedIssue.key}}</p>
    <h1>{{selectedIssue.fields.summary}}</h1>

    <table>
      <tr>
        <td style="padding-right: 50px; font-weight: bold">Type:</td>
        <td style="padding-right: 150px;">{{selectedIssue.fields.issuetype.name}}</td>
        <td style="padding-right: 50px; font-weight: bold">Status:</td>
        <td style="padding-right: 50px;">{{selectedIssue.fields.status.name}}</td>
      </tr>
      <tr>
        <td style="font-weight: bold">Priority:</td>
        <td>{{selectedIssue.fields.priority.name}}</td>
        <td style="font-weight: bold; padding-right: 50px;">Component(s):</td>
        <td *ngFor="let c of selectedIssue.fields.components">{{c.name}}</td>
      </tr>
      <tr>
        <td style="font-weight: bold">Assignee:</td>
        <td *ngIf="selectedIssue.fields.assignee;">{{selectedIssue.fields.assignee.displayName}}</td>
        <td *ngIf="!selectedIssue.fields.assignee;"></td>
        <td style="font-weight: bold">Reporter:</td>
        <td *ngIf="selectedIssue.fields.reporter;">{{selectedIssue.fields.reporter.displayName}}</td>
      </tr>
    </table>
    <br>

    <p style="font-weight: bold">Description:</p>
    <p>{{selectedIssue.fields.description}}</p><br>
    <p style="font-weight: bold">Implemented in:</p>

    <div *ngIf="edit==false && add==false">
      <table class="classes" width="100%">
        <tr style="height: 41px;" class="classes" *ngFor="let cl of selectedIssuesClasses">
          <td class="classes">{{cl}}</td>
        </tr>
      </table>
    </div>


    <div *ngIf="edit==true">
      <table class="classes" width="100%">
        <tr class="classes" *ngFor="let cl of selectedIssuesClasses">
          <td class="classes">{{cl}}</td>
          <td style="padding: 0; text-align: center; vertical-align: middle;" class="classes" width="5%">
            <button mat-icon-button (click)="del(selectedIssue.key, cl)">
              <mat-icon color="primary">delete</mat-icon>
            </button>
          </td>
        </tr>
      </table>
    </div>
    <br>

    <div *ngIf="add==true">
      <table class="classes" width="100%">
        <tr class="classes" *ngFor="let cl of selectedIssuesClasses">
          <td class="classes">{{cl}}</td>
          <td style="padding: 0; text-align: center; vertical-align: middle;" class="classes" width="5%">
            <button mat-icon-button (click)="del(selectedIssue.key, cl)">
              <mat-icon color="primary">delete</mat-icon>
            </button>
          </td>
        </tr>
        <tr>
          <td class="classes">
            <mat-form-field>
              <mat-label>Class</mat-label>
              <mat-select [formControl]="classControl" required>
                <mat-option *ngFor="let c of availableClasses" [value]="c">{{c}}</mat-option>
              </mat-select>
              <mat-error *ngIf="classControl.hasError('required')">Please choose a class.</mat-error>
            </mat-form-field>
          <td style="padding: 0;text-align: center; vertical-align: middle;" class="classes" width="5%">
            <button mat-icon-button (click)="addTrace(selectedIssue.key)">
              <mat-icon color="primary">add</mat-icon>
            </button>
          </td>
        </tr>
      </table>
    </div>


    <div *ngIf="!add && !edit">
      <button *ngIf="selectedIssuesClasses.length" mat-raised-button color="primary" style="margin-right: 5px;" (click)="edit = true">Edit
        Element
      </button>
      <button mat-raised-button color="primary" (click)="add = true; getAvailableClasses()">Add Element</button>
    </div>
    <button *ngIf="edit || add" mat-raised-button color="primary" (click)="add = false; edit = false;">Done</button>


    <p style="font-weight: bold; margin-top: 30px;">Tested in:</p>
    <div>
      <table class="classes" width="100%">
        <tr style="height: 41px;" class="classes" *ngFor="let cl of selectedIssuesClasses">
          <td class="classes">{{cl}}</td>
        </tr>
      </table>
    </div>

  </div>
</div>

